<?xml version="1.0" encoding="UTF-8"?>
  <statistics>
      
    <stat name="Top Five Species" display="Pie Chart">
      <chartinfo>
        <title>Top Five Species</title>
      </chartinfo>
      <sql type="text">
        <![CDATA[select tn,count(tx) as namecnt from (select determination.TaxonId, taxon.TaxonID as tx, taxon.Name as tn from taxon,determination where determination.TaxonId = taxon.taxonid) as newTable group by tx order by namecnt DESC;]]>
      </sql>
      <slice>
        <desc row="1" col="1"/>
        <value row="1" col="2"/>
      </slice>
      <slice>
        <desc row="2" col="1"/>
        <value row="2" col="2"/>
      </slice>
      <slice>
        <desc row="3" col="1"/>
        <value row="3" col="2"/>
      </slice>
      <slice>
        <desc row="4" col="1"/>
        <value row="4" col="2"/>
      </slice>
      <slice>
        <desc row="5" col="1"/>
        <value row="5" col="2"/>
      </slice>
    </stat>
    
    <stat name="Items Cataloged Last 5 Years" display="Bar Chart">
       <chartinfo>
         <title>Items Cataloged Last 5 Years</title>
         <xaxis>Years</xaxis>
         <yaxis>Number of Specimens</yaxis>
       </chartinfo>
      <sql type="builtin" className="edu.ku.brc.specify.dbsupport.CatalogedByYearCustomQuery"/>
    </stat>
    
    <stat name="Percentage Grow Last 5 Years" display="Bar Chart">
       <chartinfo>
         <title>Percentage Grow Last 5 Years</title>
         <xaxis>Years</xaxis>
         <yaxis>Percentage</yaxis>
       </chartinfo>
       <sql type="builtin" className="edu.ku.brc.specify.dbsupport.PercentageGrowthCustomQuery"/>
    </stat>
   <stat name="Percentage Grow Last 5 Years" display="Bar Chart">
       <chartinfo>
         <title>Percentage Grow Last 5 Years</title>
         <xaxis>Years</xaxis>
         <yaxis>Percentage</yaxis>
       </chartinfo>
       <sql type="builtin" className="edu.ku.brc.specify.dbsupport.PercentageGrowthCustomQuery"/>
    </stat>
    
    <stat name="Specimens by Country" display="Bar Chart">
      <chartinfo>
        <title>Top 7 Number of Specimens by Country</title>
      </chartinfo>
      <sql type="text">
        <![CDATA[select Country, count(CollectionObjectID) AS SpecimenCount from collectionobject as CO inner join collectingevent as CE on CE.CollectingEventID = CO.CollectingEventID inner join locality as L on L.LocalityID = CE.LocalityID inner join geography as G on G.GeographyID = L.GeographyID group by Country order by SpecimenCount DESC]]>
      </sql>
      <bar>
        <desc row="1" col="1"/>
        <value row="1" col="2"/>
      </bar>
      <bar>
        <desc row="2" col="1"/>
        <value row="2" col="2"/>
      </bar>
      <bar>
        <desc row="3" col="1"/>
        <value row="3" col="2"/>
      </bar>
      <bar>
        <desc row="4" col="1"/>
        <value row="4" col="2"/>
      </bar>
      <bar>
        <desc row="5" col="1"/>
        <value row="5" col="2"/>
      </bar>
      <bar>
        <desc row="6" col="1"/>
        <value row="6" col="2"/>
      </bar>
      <bar>
        <desc row="7" col="1"/>
        <value row="7" col="2"/>
      </bar>
    </stat>
    
    <stat name="ListOnLoan" display="Table">
      <title>Items on Loan</title>
      <sql type="text">
          <![CDATA[Select distinct loan.LoanNumber as LoanNumber, loan.LoanDate, loan.CurrentDueDate, agent.FirstName, agent.LastName,loan.OriginalDueDate, loanphysicalobject.Quantity, loanphysicalobject.DescriptionOfMaterial, address.Address, address.City, address.State, address.Country From loan Inner Join loanphysicalobject ON loan.LoanID =  loanphysicalobject.LoanID Inner Join loanagents ON loan.LoanID = loanagents.LoanID Inner Join agent ON loanagents.AgentID = agent.AgentID Inner Join address ON agent.AgentID = address.AgentID where loan.loanid in (select loanid from loan where category = 0 and (closed = 0 or closed is null)) group by LoanNumber]]>
      </sql>
    </stat>
    
    <stat name="OverdueLoansList" display="Table">
      <title>Overdue Loans</title>
      <sql type="text">
          <![CDATA[Select distinct loan.LoanNumber as LoanNumber, loan.LoanDate, loan.CurrentDueDate, agent.FirstName, agent.LastName, loan.loanid, loan.OriginalDueDate, loanphysicalobject.Quantity, loanphysicalobject.DescriptionOfMaterial, address.Address, address.City, address.State, address.Country From loan Inner Join loanphysicalobject ON loan.LoanID =  loanphysicalobject.LoanID Inner Join loanagents ON loan.LoanID = loanagents.LoanID Inner Join agent ON loanagents.AgentID = agent.AgentID Inner Join address ON agent.AgentID = address.AgentID where loan.loanid in (select loanid from loan where (not  (currentduedate is null)) and category = 0 and (closed = 0 or closed is null) and datediff(CURDATE(), currentduedate) > 0)  group by LoanNumber]]>
      </sql>
    </stat>
    
    <stat name="CatalogedLast7DaysDetail" display="Table">
      <title>Cataloged Last 7 Days</title>
      <sql type="text">
          <![CDATA[Select collectionobject.CatalogNumber,taxon.Name,collectionobject.TimestampCreated From collectionobject Inner Join determination ON collectionobject.CollectionObjectID = determination.CollectionObjectID Inner Join taxon ON determination.TaxonID = taxon.TreeID where DATE_SUB(CURDATE(), INTERVAL 7 DAY) <= collectionobject.TimestampCreated]]>
      </sql>
    </stat>
    
    <stat name="CatalogedLastMonth" display="Table">
      <title>Cataloged Last Month</title>
      <sql type="text">
          <![CDATA[Select collectionobject.CatalogNumber,taxon.Name,collectionobject.TimestampCreated From collectionobject Inner Join determination ON collectionobject.CollectionObjectID = determination.CollectionObjectID Inner Join taxon ON determination.TaxonID = taxon.TreeID where DATE_SUB(CURDATE(), INTERVAL 1 MONTH) <= collectionobject.TimestampCreated]]>
      </sql>
    </stat>
    
    <stat name="CatalogedLastYear" display="Table">
      <title>Cataloged Last Year</title>
      <sql type="text">
        <![CDATA[Select collectionobject.CatalogNumber,taxon.Name,collectionobject.TimestampCreated From collectionobject Inner Join determination ON collectionobject.CollectionObjectCatalogID = determination.BiologicalObjectID Inner Join taxon ON determination.TaxonID = taxon.TaxonID where DATE_SUB(CURDATE(), INTERVAL 1 YEAR) <= collectionobject.TimestampCreated;]]>
      </sql>
    </stat>
    
    <stat name="OverdueLookup" display="Table">
      <title>Loan Overdue</title>
      <sql type="text">
          <![CDATA[Select distinct loan.LoanNumber as LoanNumber, loan.LoanDate, loan.CurrentDueDate, agent.FirstName, agent.LastName,loan.OriginalDueDate, loanphysicalobject.Quantity, loanphysicalobject.DescriptionOfMaterial, address.Address, address.City, address.State, address.Country From loan Inner Join loanphysicalobject ON loan.LoanID =  loanphysicalobject.LoanID Inner Join loanagents ON loan.LoanID = loanagents.LoanID Inner Join agent ON loanagents.AgentID = agent.AgentID Inner Join address ON agent.AgentID = address.AgentID where loan.loanid = %s]]>
      </sql>
    </stat>
    
    <!-- ********************* -->
    <!--  Accession Statistics -->
    <!-- ********************* -->
      <stat name="AccessionByDivision" display="Bar Chart">
          <chartinfo>
              <title>Top 5 Accessions By Division</title>
          </chartinfo>
          <sql type="text">
              <![CDATA[select Text1, count(AccessionId) AS DivCount from accession where Text1 is not null group by Text1 order by DivCount desc]]>
          </sql>
          <bar>
              <desc row="1" col="1"/>
              <value row="1" col="2"/>
          </bar>
          <bar>
              <desc row="2" col="1"/>
              <value row="2" col="2"/>
          </bar>
          <bar>
              <desc row="3" col="1"/>
              <value row="3" col="2"/>
          </bar>
          <bar>
              <desc row="4" col="1"/>
              <value row="4" col="2"/>
          </bar>
          <bar>
              <desc row="5" col="1"/>
              <value row="5" col="2"/>
          </bar>
      </stat>
      
      
      <stat name="Accession" display="Form" viewset="Main Views" view="Accession" mode="view">
          <title>Permits Expiring This Year</title>
          <sql type="text">
              <![CDATA[select * From accession where accession.AccessionID = %s]]>
          </sql>
      </stat>
      
      <stat name="CITESPermitsExpireThisYear" display="Form" viewset="Main Views" view="PermitForAccessions" mode="view">
          <title>Permits Expiring This Year</title>
          <sql type="text">
              <![CDATA[select permit.PermitID, permit.PermitNumber,permit.IssuedDate,permit.StartDate,
permit.EndDate,permit.RenewalDate,permit.Type From permit where permit.PermitID = %s]]>
          </sql>
      </stat>
      
      <stat name="NonCITESPermitsExpireThisYear" display="Form" viewset="Main Views" view="PermitForAccessions" mode="view">
          <view mode="display">Permit</view>
          <title>Non-CITES Permits Expiring This Year</title>
          <sql type="text">
              <![CDATA[select permit.PermitID, permit.PermitNumber,permit.IssuedDate,permit.StartDate,
permit.EndDate,permit.RenewalDate,permit.Type From permit where permit.PermitID = %s]]>
          </sql>
      </stat>
      
      
    
  </statistics>
  